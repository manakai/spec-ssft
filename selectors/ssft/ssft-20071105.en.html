<!DOCTYPE html>
<html lang="en" class="formal-specification status-work-in-progress">
<head>
<title>Selectors Serialization Format for Testing (SSFT) Specification</title>
<link rel="stylesheet" href="http://suika.fam.cx/www/style/html/spec">
<link rel="license" href="http://suika.fam.cx/c/gnu/fdl">
</head>
<body class="has-abstract">

<div class="header">
<h1>Selectors Serialization Format for Testing (<abbr>SSFT</abbr>)
Specification</h1>
<h2>Working Draft <time datetime=2007-10-15>15 October 2007</time></h2>

<dl class="versions-uri">
<dt>This Version</dt>
  <dd><code class="URI">&lt;<a href="http://suika.fam.cx/www/markup/selectors/ssft/ssft"
      >http://suika.fam.cx/www/markup/selectors/ssft/ssft</a>&gt;</code></dd>
<dt>Latest Version</dt>
  <dd><code class="URI">&lt;<a href="http://suika.fam.cx/www/markup/selectors/ssft/ssft"
      >http://suika.fam.cx/www/markup/selectors/ssft/ssft</a>&gt;</code></dd>
<!--
<dt>Latest Working Draft</dt>
-->
<!-- <dt>Previous Version</dt> -->
<dt>Version History</dt>
  <dd><code class=URI>&lt;<a href="http://suika.fam.cx/gate/cvs/markup/selectors/ssft/ssft.en.html">http://suika.fam.cx/gate/cvs/markup/selectors/ssft/ssft.en.html</a>&gt;</code></dd>
</dl>
<dl class="authors" id="author">
<dt>Author</dt>
  <dd><a href="http://suika.fam.cx/~wakaba/who?" rel="author"
      lang=ja>Wakaba</a>
  <code class="mail">&lt;<a href="mailto:w@suika.fam.cx" rel="author"
      >w@suika.fam.cx</a>&gt;</code></dd>
</dl>

<p class="copyright" lang="en">&#xA9; <time>2007</time> <a
    href="http://suika.fam.cx/~wakaba/who?" rel="author">Wakaba</a>.
Permission is granted to copy, distribute and/or modify this document
under the terms of the <a rel="license"
href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</a>,
Version 1.2
or any later version published by the <a
href="http://www.fsf.org/">Free Software Foundation</a>;
with no Invariant Sections, no Front‐Cover Texts, and no Back‐Cover
Texts.  A copy of the license is
available at <code class="URI">&lt;<a
    href="http://www.gnu.org/copyleft/fdl.html"
    rel="license">http://www.gnu.org/copyleft/fdl.html</a>&gt;</code>.</p>
</div>

<div id="abstract" class="section">
<h2>Abstract</h2>

<div class="ed issue">...</div>

</div>

<div id="status" class="section">
<h2>Status of This Document</h2>

<p class=section-info><em>This section describes the status of this document
at the time of its publication.  Other documents
might supersede this document.</em></p>

<p>This document is a working draft, produced as part
of the <a href="http://suika.fam.cx/www/manakai-core/doc/web/">manakai</a> 
project.  It might be updated, replaced, or obsoleted by
other documents at any time.  It is inappropriate to
cite this document as other than <q>work in progress</q>.</p>

<p>Comments on this document are welcome and
may be sent to the <a href="#author">author</a>.</p>

<p>Translations of thie document might be available.
The English version of the document is the only
normative version.</p>
</div>

<div id="introduction" class="section">
<h2>Introduction</h2>

<p class=section-info>This section is <em>non‐normative</em>.</p>

<p>Selectors 
<cite class="bibref normative">[<a href="#ref-SELECTORS">SELECTORS</a>]</cite>
are patterns that match against elements
in a tree structure and are used in Web technologies, including 
<a href="http://www.w3.org/TR/CSS21"><abbr title="Cascading Style Sheets">CSS</abbr></a>
<cite class="bibref informative">[<a href="#ref-CSS">CSS</a>]</cite>,
<a href="http://whatwg.org/html5"><abbr title="Hypertext Markup Language">HTML</abbr>5</a>
<cite class="bibref informative">[<a href="#ref-HTML5">HTML5</a>]</cite>,
<a href="http://www.mozilla.org/projects/xbl/xbl2.html"><abbr title="XML Binding Language">XBL</abbr>2</a>
<cite class="bibref informative">[<a href="#ref-XBL2">XBL2</a>]</cite>, and 
<a href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/selectors-api/Overview.html?rev=1.28&amp;content-type=text/html;%20charset=utf-8">Selectors
<abbr>API</abbr></a>
<cite class="bibref informative">[<a href="#ref-SAPI">SAPI</a>]</cite>.</p>

<div class="issue ed">...</div>

<p><a href="http://dev.w3.org/cvsweb/csswg/cssom/Overview.html">The 
<abbr title="Cascading Style Sheets Object Model">CSSOM</abbr> 
specification</a> 
<cite class="bibref informative">[<a href="#ref-CSSOM">CSSOM</a>]</cite> 
is trying to define an algorithm to
<a href="http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?rev=1.55&amp;content-type=text/html;%20charset=utf-8#serializing0">serialize
a group of selectors</a> for the purpose of <code>selectorText</code>
attribute.  However, the algorithm is incomplete
<time datetime=2007-09-25>at the time of the writing</time>.  
Note that current Web browser implementations
of the <code>selectorText</code> attribute are consistently broken
in not escaping unsafe identifiers.</p>

</div>

<div class="section" id="terminology">
<h2>Terminology</h2>

<p>The key words <q><em class="rfc2119">MUST</em></q>,
<q><em class="rfc2119">MUST NOT</em></q>,
<q><em class="rfc2119">SHOULD</em></q>,
<q><em class="rfc2119">SHOULD NOT</em></q>, and
<q><em class=rfc2119>MAY</em></q> in this
document are to be interpreted as described in 
<a href="urn:ietf:rfc:2119"><abbr title="Request for Comments">RFC</abbr> 
2119</a>
<cite class="bibref normative">[<a href="#ref-KEYWORDS">KEYWORDS</a>]</cite>.</p>

<!-- Strictly speaking the paragraph below is not part of terminology. -->
<p>All examples and notes in this specification are non‐normative,
as are all sections explicitly marked non‐normative.  Everything
else in this specification is normative.</p>

<p>For the purpose of this specification, pseudo‐elements are also
referred to as <dfn title="simple selector" id=simple-selector>simple
selectors</dfn> and are considered as part of the last sequence of 
simple selector in a selector.</p>
</div>

<div class="section" id="serializing">
<h2>Serializing Groups of Selectors</h2>

<div class="issue ed">
<p><a href="http://suika.fam.cx/gate/cvs/*checkout*/markup/html/whatpm/Whatpm/CSS/SelectorsSerializer.pm">See the reference implementation</a>
for now.</p>
</div>

<p>No <abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representation is defined for an invalid group of selectors.</p>

<div class="note memo">
<p>The serialized representation will not contain any comment.</p>
</div>

<!-- TODO: link terms to Selectors -->

<p>To 
<dfn id=algorithm-serialize-a-group-of-selectors title="serialize a group of selectors">serialize
a group of selectors (<dfn id=var-gs><var>gs</var></dfn>)</dfn>:</p>
<ol>
<li>Let <dfn id=var-result><var>result</var></dfn> an empty string.</li>
<li>For each selector (<dfn id=var-selector><var>selector</var></dfn>) in 
<var>gs</var>:
  <ol>
  <li>If <var>selector</var> is <em>not</em> the first selector
  in the group of selectors, then append a <code class=char>U+002C</code>
  <code class=charname>COMMA</code> (<code class=char>,</code>) followed by a
  <a href="#newline">newline</a> to <var>result</var>.</li>
  <li>Append four <code class=char>U+0020</code>
  <code class=charname>SPACE</code> characters to <var>result</var>.</li>
  <li>Process each sequence of simple selectors or
  combinator in <var>selector</var> by following algorithm:
    <dl class=switch>
    <dt>If it is a sequence of simle selector 
    (<dfn id=var-sss><var>sss</var></dfn>)</dt>
      <dd class=ed>@@</dd>
    <dt>If it is a combinator (<dfn id=var-c><var>c</var></dfn>)</dt>
      <dd>
        <ol>
        <li>Append two <code class=char>U+0020</code>
        <code class=charname>SPACE</code> characters to <var>result</var>.</li>
        <li>
          <dl class=switch>
          <dt>If <var>c</var> is descendant combinator (white space)</dt>
            <dd>Append a <code class=char>U+0020</code>
            <code class=charname>SPACE</code> character to
            <var>result</var>.</dd>
          <dt>If <var>c</var> is child combinator
          (<code class=char>></code>)</dt>
            <dd>Append a <code class=char>U+003E</code>
            <code class=charname>GREATER-THAN SIGN</code>
            (<code class=char>></code>) character to <var>result</var>.</dd>
          <dt>If <var>c</var> is adjacent sibling combinator
          (<code class=char>+</code>)</dt>
            <dd>Append a <code class=char>U+002B</code>
            <code class=charname>PLUS SIGN</code> (<code class=char>+</code>)
            character to <var>result</var>.</dd>
          <dt>If <var>c</var> is general sibling combinator
          (<code class=char>~</code>)</dt>
            <dd>Append a <code class=char>U+007E</code>
            <code class=charname>TILDE</code> (<code class=char>~</code>)
            character to <var>result</var>.</dd>
          </dl>
        </li>
        <li>Append a <code class=char>U+0020</code>
        <code class=charname>SPACE</code> character to
        <var>result</var>.</li>
        </ol>
      </dd>
    </dl>
  </ol>
</li>
<li>Then, <var>result</var> is the 
<abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representation of <var>gs</var>.</li>
</ol>

<p>To 
<dfn id=algorithm-serialize-a-simple-selector title="serialize a simple selector">serialize
a simple selector (<dfn><var id=var-ss>ss</var></dfn>)</dfn>:</p>
<dl class=switch>
<dt>If <var>ss</var> is a type or universal selector</dt>
  <dd>
    <ol>
    <li>
      <dl class=switch>
      <dt>If a namespace URI is specified (via namespace prefix, or
      by omitting namespace prefix where a default namespace is specified)</dt>
        <dd class="ed">@@</dd>
      <dt>If the null namespace is specified (by zero‐length namespace
      prefix)</dt>
        <dd>Append a <code class=char>U+007C</code>
        <code class=charname>VERTICAL BAR</code> (<code class=char>|</code>)
        character to <var>result</var>.</dd>
      <dt>If no namespace is specified (by namespace prefix <code>*</code>,
      or by omitting namespace prefix where no default namespace is
      specified)</dt>
        <dd>Append a <code class=char>U+002A</code> 
        <code class=charname>ASTERISK</code> (<code class=char>*</code>)
        character, followed by a <code class=char>U+007C</code>
        <code class=charname>VERTICAL BAR</code> (<code class=char>|</code>)
        character, to <var>result</var>.</dd>
      </dl>
    </li>
    <li>If <var>ss</var> is a type selector, append the
    <span class=ed>@@ normalized</span> local name to <var>result</var>.</li>
    <li>If <var>ss</var> is a universal selector, append 
    a <code class=char>U+002A</code> <code class=charname>ASTERISK</code>
    (<code class=char>*</code>) character to <var>result</var>.</li>
    </ol>
  </dd>
<dt>If <var>ss</var> is an attribute selector</dt>
  <dd class=ed>@@</dd>
<dt>If <var>ss</var> is a class selector</dt>
  <dd>Append a <code class=char>U+002E</code> <code class=charname>FULL
  STOP</code> (<code class=char>.</code>) character, followed
  by <span class=ed>@@ normalized</span> class name,
  <var>result</var>.</dd>
<dt>If <var>ss</var> is an <abbr>ID</abbr> selector</dt>
  <dd>Append a <code class=char>U+0023</code> <code class=charname>NUMBER
  SIGN</code> (<code class=char>#</code>) character, followed
  by <span class=ed>@@ normalized</span> <abbr>ID</abbr>,
  to <var>result</var>.</dd>
<dt>If <var>ss</var> is a pseudo‐class selector</dt>
  <dd>
    <ol>
    <li>Append a <code class=char>U+003A</code> 
    <code class=charname>COLON</code> (<code class=char>:</code>) character
    to <var>result</var>.</li>
    <li>Append the <span class=ed>@@ normalized</span> name of the 
    pseudo‐class to <var>result</var>.</li>
    <li>Append any arguments as following:
      <dl class=switch>
      <dt>If the name of the pseudo‐class is <code>lang</code></dt>
        <dd>
          <ol>
          <li>Append a <code class=char>U+0028</code> <code class=charname>LEFT
          PARENTHESIS</code> (<code class=char>(</code>) character
          to <var>result</var>.</li>
          <li>Append <span class=ed>@@ normalized</span> 
          language tag (the argument) to <var>result</var>.</li>
          <li>Append a <code class=char>U+0029</code>
          <code class=charname>RIGHT PARENTHESIS</code> 
          (<code class=char>)</code>) character
          to <var>result</var>.</li>
          </ol>
        </dd>
      <dt>If the name of the pseudo‐class is
      <code>-manakai-contains</code></dt>
        <dd>
          <ol>
          <li>Append a <code class=char>U+0028</code> <code class=charname>LEFT
          PARENTHESIS</code> (<code class=char>(</code>) character
          to <var>result</var>.</li>
          <li>Append <span class=ed>@@ normalized</span> 
          string (the argument) to <var>result</var>.</li>
          <li>Append a <code class=char>U+0029</code>
          <code class=charname>RIGHT PARENTHESIS</code> 
          (<code class=char>)</code>) character
          to <var>result</var>.</li>
          </ol>
        </dd>
      <dt>If name of the pseudo‐class is either <code>nth-child</code>,
      <code>nth-last-child</code>, <code>nth-of-type</code>, or
      <code>nth-last-of-type</code></dt>
        <dd>
          <ol>
          <li>Append a <code class=char>U+0028</code> <code class=charname>LEFT
          PARENTHESIS</code> (<code class=char>(</code>) character
          to <var>result</var>.</li>
          <li>Append <span class=ed>@@ normalized</span>
          integer <var>a</var> to <var>result</var>.
          If the argument is a keyword <code>odd</code> or <code>even</code>,
          <var>a</var> is <code>2</code>.  If <var>a</var> and
          <code>n</code> is omitted, <var>a</var> is assumed as
          <code>0</code>.  Otherwise, if <var>a</var> is omitted,
          it is assumed as <code>1</code> (or <code>-1</code>,
          if there is a <code class=char>U+002D</code>
          <code class=charname>HYPHEN-MINUS</code> (<code class=char>-</code>)
          character).</li>
          <li>Append a <code class=char>U+006E</code> 
          <code class=charname>LATIN SMALL LETTER N</code>
          (<code class=char>n</code>) character to <var>result</var>.</li>
          <li>Append <span class=ed>@@ normalized</span>
          integer <var>b</var> to <var>result</var>.
          It <em class=rfc2119>MUST</em> be preceded by a sign,
          either <code class=char>U+002B</code> <code class=charname>PLUS
          SIGN</code> (<code class=char>+</code>) or
          <code class=char>U+002D</code> 
          <code class=charname>HYPHEN-MINUS</code> (<code class=char>-</code>)
          character.  If the argument is a keyword <code>odd</code>,
          <var>b</var> is <code>1</code>.  If the argument
          is a keyword <code>even</code>, <var>b</var> is
          <code>0</code>.  If <var>b</var> is omitted, it is assumed as
          <code>0</code>.  The sign of <code>0</code>
          <em class=rfc2119>MUST</em> be <code class=char>U+002B</code>
          <code class=charname>PLUS SIGN</code> 
          (<code class=char>+</code>).</li>
          <li>Append a <code class=char>U+0029</code>
          <code class=charname>RIGHT PARENTHESIS</code>
          (<code class=char>)</code>) character
          to <var>result</var>.</li>
          </ol>
        </dd>
      <dt>If the name of the pseudo‐class is <code>not</code></dt>
        <dd>
          <ol>
            <li>Append a string of <code class=char>U+003A</code>
            <code class=charname>COLON</code>, <code class=char>U+006E</code>
            <code class=charname>LATIN SMALL LETTER N</code>,
            <code class=char>U+006F</code> <code class=charname>LATIN
            SMALL LETTER O</code>, <code class=char>U+0074</code>
            <code class=charname>LATIN SMALL LETTER T</code>, and
            <code class=char>U+0028</code> <code class=charname>LEFT
            PARENTHESIS</code> (<code>:not(</code>), followed by a
            <a href="#newline">newline</a>, to <var>result</var>.</li>
            <li>Append four <code class=char>U+0020</code>
            <code class=charname>SPACE</code> characters to 
            <var>result</var>.</li>
            <li>Append four <code class=char>U+0020</code>
            <code class=charname>SPACE</code> characters to 
            <var>result</var> again.</li>
            <li><a href="#algorithm-serialize-a-simple-selector">Serialize
            the simple selector specified as the argument to the
            <code>not</code> pseudo‐class</a>.</li>
            <li>Append a <a href="#newline">newline</a> to
            <var>result</var>.</li>
            <li>Append four <code class=char>U+0020</code>
            <code class=charname>SPACE</code> characters to
            <var>result</var>.</li>
            <li>Append a <code class=char>U+0029</code>
            <code class=charname>RIGHT PARENTHESIS</code>
            (<code class=char>)</code>) character
            to <var>result</var>.</li>
          </ol>
        </dd>
      </dl>
    </li>
    </ol>
  </dd>
<dt>If <var>ss</var> is a pseudo‐element</dt>
  <dd>
    <ol>
    <li>Append two <code class=char>U+003A</code>
    <code class=charname>COLON</code> characters (<code>::</code>)
    to <var>result</var>.</li>
    <li>Append the <span class=ed>@@ normalized</span> name of the
    pseudo‐element to <var>result</var>.</li>
    <!-- For future version: append "(", arguments, ")", if any. -->
    </ol>
  </dd>
</dl>


<p>A <dfn id=newline title=newline>newline</dfn> 
<em class=rfc2119>SHOULD</em> be represented as a
<code class=char>U+000A</code> <code class=charname>LINE FEED</code>
character.  However, depending on the context where
the <abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representation is in use, a sequence of 
<code class=char>U+000D</code> <code class=charname>CARRIAGE RETURN</code>
followed by a <code class=char>U+000A</code> 
<code class=charname>LINE FEED</code> or a character
<code class=char>U+000D</code> <code class=charname>CARRIAGE RETURN</code>
<em class=rfc2119>MAY</em> be used as a newline instead.</p>

<div class="note memo">
<p>Therefore, when 
<abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representations are literally compared, newlines must be normalized.</p>
</div>

</div>

<div class="section" id="parsing">
<h2>Parsing 
<abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
Groups of Selectors</h2>

<p>Since <a href="#serializing">the serializing algorithm</a> is 
so designed that it always output a valid 
<a href="http://www.w3.org/TR/css3-selectors/#grouping">group of
selectors</a>, no special parser for the
<abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representation is necessary.  Any conforming parser for
<a href="http://www.w3.org/TR/css3-selectors/#grouping">groups of
selectors</a> <em class=rfc2119>MAY</em> be used
to parse <abbr title="Selectors Serialization Format for Testing">SSFT</abbr> 
representations of groups of selectors.</p>
</div>

<div class="section" id="examples">
<h2>Examples</h2>

<p class=section-info>This section is <em>non‐normative</em>.</p>

<div class="ed issue">
<p><a href="http://suika.fam.cx/gate/2007/css/parser-interface">Try demo</a>,
by choosing <q>Selectors</q> radio button.</p>

<div class="example figure block">
<div class="caption">...</div>

<pre><code>...</code></pre>
</div>

</div>

</div>

<div id="references" class="section reference">
<h2>References</h2>

<div id="normative-references" class="section normative reference">
<h3>Normative References</h3>

<dl>
<dt id="ref-KEYWORDS">KEYWORDS</dt>
  <dd><cite><a href="urn:ietf:rfc:2119">Key words for use in 
  <abbr>RFCs</abbr> to Indicate Requirement Levels</a></cite>,
  <abbr title="Internet Engineering Task Force">IETF</abbr> 
  <a href="urn:ietf:bcp:14"><abbr title="Best Current Practice">BCP</abbr> 
  14</a>, <abbr title="Request for Comments">RFC</abbr> 2119, 
  <time datetime=1997-03>March 1997</time>.
  This version of the specification is referenced</dd>
<dt id=ref-SELECTORS>SELECTORS</dt>
  <dd><a href="http://www.w3.org/TR/2005/WD-css3-selectors-20051215"><cite>Selectors</cite></a>,
  <abbr title="World Wide Web Consortium">W3C</abbr> Working Draft,
  <time datetime=2005-12-15>15 December 2005</time>.  Work in progress.  
  <a href="http://www.w3.org/TR/css3-selectors">The latest version</a>
  of the specification is referenced.</dd>
</dl>
</div>

<div id="informative-references" class="section informative reference">
<h3>Non‐normative References</h3>

<dl>
<dt id=ref-CSS>CSS</dt>
  <dd><cite><a href="http://www.w3.org/TR/2007/CR-CSS21-20070719">Cascading
  Style Sheets Level 2 Revision 1 (<abbr>CSS</abbr> 2.1)
  Specification</a></cite>, 
  <abbr title="World Wide Web Consortium">W3C</abbr> Candidate
  Recommendation, <time datetime=2007-07-19>19 July 2007</time>.
  Work in progress.  The latest version of the specification is
  available at 
  <code class=URI>&lt;<a href="http://www.w3.org/TR/CSS21">http://www.w3.org/TR/CSS21</a>></code>.</dd>
<dt id=ref-CSSOM>CSSOM</dt>
  <dd><cite><a href="http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?rev=1.55&amp;content-type=text/html;%20charset=utf-8">Cascading
  Style Sheets Object Model (<abbr>CSSOM</abbr>)</a></cite>,
  <abbr title="World Wide Web Consortium">W3C</abbr> Editor's Draft,
  <time datetime=2007-06-18>18 June 2007</time>.  Work in progress.
  The latest Editor's Draft of the specification is available at
  <code class=URI>&lt;<a href="http://dev.w3.org/csswg/cssom/Overview.html">http://dev.w3.org/csswg/cssom/Overview.html</a>></code>.</dd>
<dt id=ref-HTML5>HTML5</dt>
  <dd><cite><a href="http://whatwg.org/html5"><abbr>HTML</abbr> 5</a></cite>,
  <abbr title="Web Hypertext Application Technology Working Group">WHATWG</abbr>
  Working Draft.  Work in progress.</dd>
<dt id=ref-SAPI>SAPI</dt>
  <dd><cite><a href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/selectors-api/Overview.html?rev=1.28&amp;content-type=text/html;%20charset=utf-8">Selectors <abbr>API</abbr></a></cite>,
  <abbr title="World Wide Web Consortium">W3C</abbr> Editor's Draft,
  <time datetime=2007-08-29>29 August 2007</time>.  Work in progress.
  The latest Editor's Draft of the specification is available at
  <code class=URI>&lt;<a href="http://dev.w3.org/2006/webapi/selectors-api/Overview.html">http://dev.w3.org/2006/webapi/selectors-api/Overview.html</a>></code>.
  The latest published version of the specification is available at
  <code class=URI>&lt;<a href="http://www.w3.org/TR/selectors-api/">http://www.w3.org/TR/selectors-api/</a>></code>.</dd>
<dt id=XBL2>XBL2</dt>
  <dd><cite><a href="http://www.mozilla.org/projects/xbl/xbl2.html"><abbr>XBL</abbr>
  2.0</a></cite>, Mozilla.org, <time datetime=2007-03-15>15 Mar 2007</time>.
  Work in progress.  The latest
  <abbr title="World Wide Web Consortium">W3C</abbr>‐published
  version of the specification is available at
  <code class=URI>&lt;<a href="http://www.w3.org/TR/xbl/">http://www.w3.org/TR/xbl/</a>></code>.</dd>
</dl>
</div>

</div>

</body>
</html>
