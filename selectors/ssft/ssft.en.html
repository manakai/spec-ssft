<!DOCTYPE html>
<html lang="en" class="formal-specification status-work-in-progress">
<head>
<title>Selectors Serialization Format for Testing (SSFT) Specification</title>
<link rel="stylesheet" href="http://suika.fam.cx/www/style/html/spec">
<link rel="license" href="http://suika.fam.cx/c/gnu/fdl">
</head>
<body class="has-abstract">

<div class="header">
<h1>Selectors Serialization Format for Testing (<abbr>SSFT</abbr>)
Specification</h1>
<h2>Working Draft <time datetime=2007-11-05>5 November 2007</time></h2>

<dl class="versions-uri">
<dt>This Version</dt>
  <dd><code class="URI">&lt;<a href="http://suika.fam.cx/www/markup/selectors/ssft/ssft"
      >http://suika.fam.cx/www/markup/selectors/ssft/ssft</a>&gt;</code></dd>
<dt>Latest Version</dt>
  <dd><code class="URI">&lt;<a href="http://suika.fam.cx/www/markup/selectors/ssft/ssft"
      >http://suika.fam.cx/www/markup/selectors/ssft/ssft</a>&gt;</code></dd>
<!--
<dt>Latest Working Draft</dt>
-->
<!-- <dt>Previous Version</dt> -->
<dt>Version History</dt>
  <dd><code class=URI>&lt;<a href="http://suika.fam.cx/gate/cvs/markup/selectors/ssft/ssft.en.html">http://suika.fam.cx/gate/cvs/markup/selectors/ssft/ssft.en.html</a>&gt;</code></dd>
</dl>
<dl class="authors" id="author">
<dt>Author</dt>
  <dd><a href="http://suika.fam.cx/~wakaba/who?" rel="author"
      lang=ja>Wakaba</a>
  <code class="mail">&lt;<a href="mailto:w@suika.fam.cx" rel="author"
      >w@suika.fam.cx</a>&gt;</code></dd>
</dl>

<p class="copyright" lang="en">&#xA9; <time>2007</time> <a
    href="http://suika.fam.cx/~wakaba/who?" rel="author">Wakaba</a>.
Permission is granted to copy, distribute and/or modify this document
under the terms of the <a rel="license"
href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</a>,
Version 1.2
or any later version published by the <a
href="http://www.fsf.org/">Free Software Foundation</a>;
with no Invariant Sections, no Front‐Cover Texts, and no Back‐Cover
Texts.  A copy of the license is
available at <code class="URI">&lt;<a
    href="http://www.gnu.org/copyleft/fdl.html"
    rel="license">http://www.gnu.org/copyleft/fdl.html</a>&gt;</code>.</p>
</div>

<div id="abstract" class="section">
<h2>Abstract</h2>

<div class="ed issue">...</div>

</div>

<div id="status" class="section">
<h2>Status of This Document</h2>

<p class=section-info><em>This section describes the status of this document
at the time of its publication.  Other documents
might supersede this document.</em></p>

<p>This document is a working draft, produced as part of the
<a href="http://suika.fam.cx/www/markup/html/whatpm/readme">Whatpm</a>
subproject
of the <a href="http://suika.fam.cx/www/manakai-core/doc/web/">manakai</a> 
project.  It might be updated, replaced, or obsoleted by
other documents at any time.  It is inappropriate to
cite this document as other than <q>work in progress</q>.</p>

<p>Comments on this document are welcome and
may be sent to the <a href="#author">author</a>.</p>

<p>Translations of thie document might be available.
The English version of the document is the only
normative version.</p>
</div>

<div id="introduction" class="section">
<h2>Introduction</h2>

<p class=section-info>This section is <em>non‐normative</em>.</p>

<p>Selectors 
<cite class="bibref normative">[<a href="#ref-SELECTORS">SELECTORS</a>]</cite>
are patterns that match against elements
in a tree structure and are used in Web technologies, including 
<a href="http://www.w3.org/TR/CSS21"><abbr title="Cascading Style Sheets">CSS</abbr></a>
<cite class="bibref informative">[<a href="#ref-CSS">CSS</a>]</cite>,
<a href="http://whatwg.org/html5"><abbr title="Hypertext Markup Language">HTML</abbr>5</a>
<cite class="bibref informative">[<a href="#ref-HTML5">HTML5</a>]</cite>,
<a href="http://www.mozilla.org/projects/xbl/xbl2.html"><abbr title="XML Binding Language">XBL</abbr>2</a>
<cite class="bibref informative">[<a href="#ref-XBL2">XBL2</a>]</cite>, and 
<a href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/selectors-api/Overview.html?rev=1.28&amp;content-type=text/html;%20charset=utf-8">Selectors
<abbr>API</abbr></a>
<cite class="bibref informative">[<a href="#ref-SAPI">SAPI</a>]</cite>.</p>

<p>It is so flexible language that a conceptually same pattern
can be represented in inifnite numbers of instances of selectors.
It might be convinient for e.g. validation of a test result to 
define a subset of the language, in which no semantically equivalent 
selectors are contained.</p>

<p><a href="http://dev.w3.org/cvsweb/csswg/cssom/Overview.html">The 
<abbr title="Cascading Style Sheets Object Model">CSSOM</abbr> 
specification</a> 
<cite class="bibref informative">[<a href="#ref-CSSOM">CSSOM</a>]</cite> 
is trying to define an algorithm to
<a href="http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?rev=1.55&amp;content-type=text/html;%20charset=utf-8#serializing0">serialize
a group of selectors</a> for the purpose of <code>selectorText</code>
attribute.  However, the algorithm is incomplete
<time datetime=2007-09-25>at the time of the writing</time>.  
Note that current Web browser implementations
of the <code>selectorText</code> attribute are consistently broken
in not escaping unsafe identifiers and therefore it is not wise
to deploy that format for testing.</p>

</div>

<div class="section" id="terminology">
<h2>Terminology</h2>

<p>The key words <q><dfn id=must><em class="rfc2119">MUST</em></dfn></q>,
<q><dfn id=must-not><em class="rfc2119">MUST NOT</em></dfn></q>,
<q><dfn id=should><em class="rfc2119">SHOULD</em></dfn></q>,
<q><dfn id=should-not><em class="rfc2119">SHOULD NOT</em></dfn></q>, and
<q><dfn id=may><em class=rfc2119>MAY</em></dfn></q> in this
document are to be interpreted as described in 
<a href="urn:ietf:rfc:2119"><abbr title="Request for Comments">RFC</abbr> 
2119</a>
<cite class="bibref normative">[<a href="#ref-KEYWORDS">KEYWORDS</a>]</cite>.</p>

<p>Requirements phrased in the imperative as part of algorithms are to be 
interpreted with the meaning of the key word (<em class=rfc2119>MUST</em>)
used in introducing the algorithm.</p>

<p>Conformance requirements phrased as algorithms or specific steps 
<em class=rfc2119>MAY</em> be implemented in any manner, so long as the end
result is equivalent.</p>

<!-- Strictly speaking the paragraph below is not part of terminology. -->
<p>All examples and notes in this specification are non‐normative,
as are all sections explicitly marked non‐normative.  Everything
else in this specification is normative.</p>

<p>For the purpose of this specification, pseudo‐elements are also
referred to as <dfn title="simple selector" id=simple-selector>simple
selectors</dfn> and are considered as part of the last sequence of 
simple selector in a selector.</p>
</div>

<div class="section" id="serializing">
<h2>Serializing Selectors in
<abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
Representation</h2>

<p>Subsections of this section define algorithms
to <a href="#algorithm-serialize-a-simple-selector">serialize a simple 
selector</a> or <a href="#algorithm-serialize-a-group-of-selectors">serialize
a group of selectors</a>.</p>

<div class="note memo">
<p>The serialized representation will not contain any comment.</p>
</div>

<div class="ed issue"><p>TODO: link terms to Selectors</p></div>

<div class=section id=serializing-tokens>
<h3>Serializing Tokens</h3>

<p>To <dfn id=algorithm-normalize-an-ident title="normalize a string as an IDENT">normalize
a string (<dfn id=var-n><var>n</var></dfn>) as an <code>IDENT</code></dfn>,
the following algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
<li>If <var>n</var> is either an <code>IDENT</code> or a <code>HASH</code>, 
replace the escape sequences (<code>\</code> and following characters) in 
<var>n</var> by characters represented by them respectively.</li>
<li>If <var>n</var> is a <code>HASH</code>, remove the leading 
<code class=char>U+0023</code> <code class=charname>NUMBER SIGN</code>
(<code class=char>#</code>) character from <var>n</var>.</li>
<li>If there is any character that is <em>not</em> one of 
<code class=char>U+002D</code> <code class=charname>HYPHEN-MINUS</code> 
(<code class=char>-</code>), <code class=char>U+0030</code>
<code class=charname>DIGIT ZERO</code> 
(<code class=char>0</code>) to <code class=char>U+0039</code> 
<code class=charname>DIGIT NINE</code> (<code class=char>9</code>),
<code class=char>U+0041</code> <code class=charname>LATIN CAPITAL LETTER
A</code> (<code class=char>A</code>) to <code class=char>U+005A</code> 
<code class=charname>LATIN CAPITAL LETTER Z</code> (<code class=char>Z</code>),
<code class=char>U+005F</code> <code class=charname>LOW LINE</code>
(<code class=char>_</code>), <code class=char>U+0061</code> 
<code class=charname>LATIN SMALL LETTER A</code> 
(<code class=char>a</code>) to <code class=char>U+006A</code>
<code class=charname>LATIN SMALL LETTER Z</code> (<code class=char>z</code>),
<code class=char>U+0080</code> to <code class=char>U+D7FF</code>, or
<code class=char>U+E000</code> to <code class=char>U+10FFFF</code> in
<var>n</var>, then replace it by string <code>\<var>HHHHHH</var></code>, where
<dfn id=var-HHHHHH><var>HHHHHH</var></dfn> is the upper‐case zero‐padded
hexadecimal representation of the character.  If the character
is outside the range of <code>[<code class=char>U+0000</code>, 
<code class=char>U+10FFFF</code>]</code>, <var>HHHHHH</var> 
<em class=rfc2119>MUST</em> be <code>FFFFFF</code>.</li>
<li>If the first character in <var>n</var> is one of 
<code class=char>U+0030</code> <code class=charname>DIGIT ZERO</code> 
(<code class=char>0</code>) to <code class=char>U+0039</code>
<code class=charname>DIGIT NINE</code> (<code class=char>9</code>),
then prepend a string <code>\00003</code> at the beginning of 
<var>n</var>.</li>
<li>If the first character in <var>n</var> is <code class=char>U+002D</code>
<code class=charname>HYPHEN-MINUS</code> (<code class=char>-</code>) and
the second character, if any, is <em>not</em> one of 
<code class=char>U+0041</code> <code class=charname>LATIN CAPITAL LETTER
A</code> (<code class=char>A</code>) to <code class=char>U+005A</code> 
<code class=charname>LATIN CAPITAL LETTER Z</code> (<code class=char>Z</code>),
<code class=char>U+005F</code> <code class=charname>LOW LINE</code>
(<code class=char>_</code>), <code class=char>U+0061</code> 
<code class=charname>LATIN SMALL LETTER A</code> 
(<code class=char>a</code>) to <code class=char>U+006A</code>
<code class=charname>LATIN SMALL LETTER Z</code> (<code class=char>z</code>),
<code>U+0080</code> to <code>U+D7FF</code>, or
<code>U+E000</code> to <code>U+10FFFF</code>, or
<var>n</var> is equal to <code class=char>U+002D</code>
<code class=charname>HYPHEN-MINUS</code> (<code class=char>-</code>), then
replace the <code class=char>U+002D</code>
<code class=charname>HYPHEN-MINUS</code> (<code class=char>-</code>)
character by string <code>\00002D</code>.</li>
<li>Then, <var>n</var> is the result of the algorithm.</li>
</ol>

<p>To <dfn id=algorithm-normalize-a-string title="normalize a string (STRING or IDENT) as a STRING">normalize
a string (<dfn id=var-s><var>s</var></dfn>) as a <code>STRING</code></dfn>,
the following algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
<li>If <var>s</var> is either an <code>IDENT</code> or a
<code>STRING</code>, replace the escape sequences (<code>\</code> and 
following characters) in <var>s</var> by characters represented by them
(or an empty string if <code>\</code> is immediately followed by
newline character(s)) respectively.</li>
<li>If <var>s</var> is a <code>STRING</code>, remove the quotation marks
enclosing <var>s</var>.</li>
<li><p>If there is any character that is <em>not</em> one of 
<code class=char>U+0020</code> <code class=charname>SPACE</code>,
<code class=char>U+0021</code> <code class=charname>EXCLAMATION MARK</code>
(<code class=char>!</code>), <code class=char>U+0023</code> 
<code class=charname>NUMBER SIGN</code> (<code class=char>#</code>) to
<code class=char>U+005B</code> <code class=charname>LEFT SQUARE
BRACKET</code>, <code class=char>U+005D</code> <code class=charname>RIGHT
SQUARE BRACKET</code> to <code class=char>U+D7FF</code>, or
<code class=char>U+E000</code> to <code class=char>U+10FFFF</code> in 
<var>s</var>, then replace it by string <code>\<var>HHHHHH</var></code>, where
<dfn id=var-HHHHHH><var>HHHHHH</var></dfn> is the upper‐case zero‐padded
hexadecimal representation of the character.  If the character
is outside the range of <code>[<code class=char>U+0000</code>, 
<code class=char>U+10FFFF</code>]</code>, <var>HHHHHH</var> 
<em class=rfc2119>MUST</em> be <code>FFFFFF</code>.</p></li>
<li><p>Insert a <code class=char>U+0022</code> <code class=charname>QUOTATION 
MARK</code> (<code class=char>"</code>) at the beginning of 
<var>s</var>.</p></li>
<li><p>Insert a <code class=char>U+0022</code> <code class=charname>QUOTATION 
MARK</code> (<code class=char>"</code>) at the end of <var>s</var>.</p></li>
<li><p>Then, <var>s</var> is the result of the algorithm.</p></li>
</ol>

<p>A <dfn id=newline title=newline>newline</dfn> 
<em class=rfc2119>SHOULD</em> be represented as a
<code class=char>U+000A</code> <code class=charname>LINE FEED</code>
character.  However, depending on the context where
the <abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representation is in use, a sequence of 
<code class=char>U+000D</code> <code class=charname>CARRIAGE RETURN</code>
followed by a <code class=char>U+000A</code> 
<code class=charname>LINE FEED</code> (i.e. a
<code>CRLF</code> sequence) or a character
<code class=char>U+000D</code> <code class=charname>CARRIAGE RETURN</code>
<em class=rfc2119>MAY</em> be used as a <a href="#newline">newline</a> instead.
<a href="#newline">Newline</a> representations 
<em class=rfc2119>SHOULD</em> be consistent in an
<abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representation.</p>

<div class="note memo">
<p>Therefore, newlines must be normalized before 
<abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representations are literally compared.</p>
</div>

<div class="issue ed">
<p>Need to define <dfn id=lower-case>lower‐case</dfn>.
It is tr/A-Z/a-z/ for now.</p>
</div>

<p>To 
<dfn id=algorithm-normalize-an-integer title="normalize an integer">normalize
an integer (<dfn id=var-int-i><var>i</var></dfn>)</dfn>, the following
algorithm <em class=rfc2119>MUST</em> be run:</p>
<ol class=algorithm>
<li>If <var>i</var> is equal to zero (0), return a string with only a
character: <code class=char>U+0030</code> 
<code class=charname>DIGIT ZERO</code> (<code class=char>0</code>).
Stop the algorithm.</li>
<li>Let <dfn id=var-int-result><var>result</var></dfn> be an empty string.</li>
<li>If <var>i</var> is less than zero (0), append a 
<code class=char>U+002D</code> <code class=charname>HYPHEN-MINUS</code>
(<code class=char>-</code>) character to <var>result</var>.</li>
<li>Append the decimal representation of the absolute value of
<var>i</var> to <var>result</var>.  The decimal (base‐ten) representation
<em class=rfc2119>MUST NOT</em> begin with a <code class=char>U+0030</code>
<code class=charname>DIGIT ZERO</code> (<code class=char>0</code>)
character.</li>
<li>Return <var>result</var>.</li>
</ol>

</div>


<div class=section id=serializing-simple-selectors>
<h3>Serializing Simple Selectors</h3>

<p>No <abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representation is defined for an invalid <a href="#simple-selector">simple
selector</a>.</p>

<p>To 
<dfn id=algorithm-serialize-a-simple-selector title="serialize a simple selector">serialize
a simple selector (<dfn><var id=var-ss>ss</var></dfn>)</dfn>,
the following algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
<li>Let <dfn id=var-r><var>r</var></dfn> an empty string.</li>
<li>Process <var>ss</var> as following:

<dl class=switch>
<dt>If <var>ss</var> is a type or universal selector</dt>
  <dd>
    <ol>
    <li>Append a namespace prefix as following:

      <dl class=switch>
      <dt>If a namespace URI is specified (via namespace prefix, or
      by omitting namespace prefix where a default namespace is specified)</dt>
        <dd>Append the namespace URI as a 
        <a href="#algorithm-normalize-an-ident" title="normalize a string as an IDENT">normalized
        <code>IDENT</code></a> to <var>r</var>.  Then, append a
        <code class=char>U+007C</code>
        <code class=charname>VERTICAL BAR</code> (<code class=char>|</code>)
        character to <var>r</var>.</dd>
      <dt>If the null namespace is specified (by zero‐length namespace
      prefix)</dt>
        <dd>Append a <code class=char>U+007C</code>
        <code class=charname>VERTICAL BAR</code> (<code class=char>|</code>)
        character to <var>r</var>.</dd>
      <dt>If no namespace is specified (by namespace prefix <code>*</code>,
      or by omitting namespace prefix where no default namespace is
      specified)</dt>
        <dd>Append a <code class=char>U+002A</code> 
        <code class=charname>ASTERISK</code> (<code class=char>*</code>)
        character, followed by a <code class=char>U+007C</code>
        <code class=charname>VERTICAL BAR</code> (<code class=char>|</code>)
        character, to <var>r</var>.</dd>
      </dl>
    </li>
    <li>If <var>ss</var> is a type selector, append the
    <a href="#algorithm-normalize-an-ident" title="normalize a string (IDENT) an IDENT">normalized</a> 
    local name to <var>r</var>.</li>
    <li>If <var>ss</var> is a universal selector, append 
    a <code class=char>U+002A</code> <code class=charname>ASTERISK</code>
    (<code class=char>*</code>) character to <var>r</var>.</li>
    </ol>
  </dd>
<dt>If <var>ss</var> is an attribute selector</dt>
  <dd>
    <ol>
    <li>Append a <code class=char>U+005B</code> <code class=charname>LEFT
    SQUARE BRACKET</code> (<code class=char>[</code>) to 
    <var>r</var>.</li>
    <li>
      Append a namespace prefix as following:
      <dl>
      <dt>If a namespace URI is specified</dt>
        <dd>Append the namespace URI as a
        <a href="#algorithm-normalize-an-ident" title="normalize a string as an IDENT">normalized
        <code>IDENT</code></a> to <var>r</var>.  Then, append a
        <code class=char>U+007C</code>
        <code class=charname>VERTICAL BAR</code> (<code class=char>|</code>)
        character to <var>r</var>.</dd>
      <dt>If the null namespace is specified</dt>
        <dd>Append a <code class=char>U+007C</code>
        <code class=charname>VERTICAL BAR</code> character to
        <var>r</var>.</dd>
      <dt>If no namespace is specified</dt>
        <dd>Append a <code class=char>U+002A</code>
        <code class=charname>ASTERISK</code> (<code class=char>*</code>)
        character, followed by a <code class=char>U+007C</code>
        <code class=charname>VERTICAL BAR</code> (<code class=char>|</code>)
        character, to <var>r</var>.</dd>
      </dl>
    </li>
    <li>Append the
    <a href="#algorithm-normalize-an-ident" title="normalize a string (IDENT) as an IDENT">normalized</a>
    local name to <var>r</var>.</li>
    <li>If a value is specified in <var>ss</var>:
      <ol>
      <li>Depending on the way to match, append <code>=</code>, 
      <code>~=</code>, <code>|=</code>, <code>^=</code>,
      <code>$=</code>, or <code>*=</code> to <var>r</var>.</li>
      <li>Append the
      <a href="#algorithm-normalize-a-string" title="normalize a string">normalized</a>
      value to <var>r</var>.</li>
      </ol>
    </li>
    <li>Append a <code class=char>U+005D</code> <code class=charname>RIGHT
    SQUARE BRACKET</code> (<code class=char>]</code>) to
    <var>r</var>.</li>
    </ol>
  </dd>
<dt>If <var>ss</var> is a class selector</dt>
  <dd>Append a <code class=char>U+002E</code> <code class=charname>FULL
  STOP</code> (<code class=char>.</code>) character, followed
  by <a href="#algorithm-normalize-an-ident" title="normalize a string (IDENT) as an IDENT">normalized</a>
  class name, to <var>r</var>.</dd>
<dt>If <var>ss</var> is an <abbr>ID</abbr> selector</dt>
  <dd>Append a <code class=char>U+0023</code> <code class=charname>NUMBER
  SIGN</code> (<code class=char>#</code>) character, followed
  by <a href="#algorithm-normalize-an-ident" title="normalize a string (HASH except for the leading #) as an IDENT">normalized</a>
  <abbr>ID</abbr>, to <var>r</var>.</dd>
<dt>If <var>ss</var> is a pseudo‐class selector</dt>
  <dd>
    <ol>
    <li>Append a <code class=char>U+003A</code> 
    <code class=charname>COLON</code> (<code class=char>:</code>) character
    to <var>r</var>.</li>
    <li>Append the
    <a href="#algorithm-normalize-an-ident" title="normalize a string (IDENT) as an IDENT">normalized</a>
    name (in <a href="#lower-case">lower‐case</a>) of the pseudo‐class to
    <var>r</var>.</li>
    <li>Append any arguments as following:
      <dl class=switch>
      <dt>If the name of the pseudo‐class is <code>lang</code></dt>
        <dd>
          <ol>
          <li>Append a <code class=char>U+0028</code> <code class=charname>LEFT
          PARENTHESIS</code> (<code class=char>(</code>) character
          to <var>r</var>.</li>
          <li>Append the
          <a href="#algorithm-normalize-an-ident" title="normalize a string (IDENT) as an IDENT">normalized</a>
          language tag (the argument) to <var>r</var>.
          <span class="issue ed">Should we normalize cases?</span></li>
          <li>Append a <code class=char>U+0029</code>
          <code class=charname>RIGHT PARENTHESIS</code> 
          (<code class=char>)</code>) character
          to <var>r</var>.</li>
          </ol>
        </dd>
      <dt>If the name of the pseudo‐class is
      <code>-manakai-contains</code></dt>
        <dd>
          <ol>
          <li>Append a <code class=char>U+0028</code> <code class=charname>LEFT
          PARENTHESIS</code> (<code class=char>(</code>) character
          to <var>r</var>.</li>
          <li>Append the
          <a href="#algorithm-normalize-a-string" title="normalize a string">normalized</a>
          string (the argument) to <var>r</var>.</li>
          <li>Append a <code class=char>U+0029</code>
          <code class=charname>RIGHT PARENTHESIS</code> 
          (<code class=char>)</code>) character
          to <var>r</var>.</li>
          </ol>
        </dd>
      <dt>If name of the pseudo‐class is either <code>nth-child</code>,
      <code>nth-last-child</code>, <code>nth-of-type</code>, or
      <code>nth-last-of-type</code></dt>
        <dd>
          <ol>
          <li>Append a <code class=char>U+0028</code> <code class=charname>LEFT
          PARENTHESIS</code> (<code class=char>(</code>) character
          to <var>r</var>.</li>
          <li>Let <dfn id=var-a><var>a</var></dfn> be the <var>a</var>
          part of the argument.  If the argument is a keyword <code>odd</code>
          or <code>even</code>, then let <var>a</var> be <code>2</code>.
          If the <var>a</var> part with following <code>n</code> character
          is omitted, then let <var>a</var> be <code>0</code>.
          Otherwise, if only the <var>a</var> part is omitted, then
          let <var>a</var> be <code>1</code>.  Otherwise, if the <var>a</var>
          part is <code>-</code>, then let <var>a</var> be
          <code>-1</code>.</li>
          <li>Let <var>a</var> be the
          <a href="#algorithm-normalize-an-integer" title="normalize an integer">normalized
          string representation</a> of integer <var>a</var>.</li>
          <li>Append <var>a</var> to <var>result</var>.</li>
          <li>Append a <code class=char>U+006E</code> 
          <code class=charname>LATIN SMALL LETTER N</code>
          (<code class=char>n</code>) character to <var>r</var>.</li>
          <li>Let <dfn id=var-b><var>b</var></dfn> be the <var>b</var>
          part of the argument.  If the argument is a keyword <code>odd</code>,
          then let <var>b</var> be <code>1</code>.  If the argument is a
          keyword <code>even</code>, then let <var>b</var> be <code>0</code>.
          If the <var>b</var> part is omitted, then let <var>b</var> be
          <code>0</code>.</li>
          <li>Let <var>b</var> be the
          <a href="#algorithm-normalize-an-integer" title="normalize an integer">normalized
          string representation</a> of integer <var>b</var>.</li>
          <li>If <var>b</var> does <em>not</em> start with a
          <code class=char>U+002D</code>
          <code class=charname>HYPHEN-MINUS</code> (<code class=char>-</code>)
          character, then append <code class=char>U+002B</code>
          <code class=charname>PLUS SIGN</code>
          (<code class=char>+</code>) to <var>result</var>.</li>
          <li>Append <var>b</var> to <var>result</var>.</li>
          <li>Append a <code class=char>U+0029</code>
          <code class=charname>RIGHT PARENTHESIS</code>
          (<code class=char>)</code>) character
          to <var>r</var>.</li>
          </ol>
        </dd>
      <dt>If the name of the pseudo‐class is <code>not</code></dt>
        <dd>
          <ol>
            <li>Append a string of <code class=char>U+003A</code>
            <code class=charname>COLON</code>, <code class=char>U+006E</code>
            <code class=charname>LATIN SMALL LETTER N</code>,
            <code class=char>U+006F</code> <code class=charname>LATIN
            SMALL LETTER O</code>, <code class=char>U+0074</code>
            <code class=charname>LATIN SMALL LETTER T</code>, and
            <code class=char>U+0028</code> <code class=charname>LEFT
            PARENTHESIS</code> (<code>:not(</code>), followed by a
            <a href="#newline">newline</a>, to <var>r</var>.</li>
            <li>Append four <code class=char>U+0020</code>
            <code class=charname>SPACE</code> characters to 
            <var>r</var>.</li>
            <li>Append four <code class=char>U+0020</code>
            <code class=charname>SPACE</code> characters to 
            <var>r</var> again.</li>
            <li><a href="#algorithm-serialize-a-simple-selector">Serialize
            the simple selector specified as the argument to the
            <code>not</code> pseudo‐class</a>.</li>
            <li>Append a <a href="#newline">newline</a> to
            <var>r</var>.</li>
            <li>Append four <code class=char>U+0020</code>
            <code class=charname>SPACE</code> characters to
            <var>r</var>.</li>
            <li>Append a <code class=char>U+0029</code>
            <code class=charname>RIGHT PARENTHESIS</code>
            (<code class=char>)</code>) character
            to <var>r</var>.</li>
          </ol>
        </dd>
      <dt>Otherwise</dt>
        <dd>The pseudo‐class is not supported by this version of 
        <abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
        and therefore no 
        <abbr title="Selectors Serialization Format for Testing">SSFT</abbr> 
        representation is defined for <var>ss</var>.  Stop the algorithm.</dd>
      </dl>
    </li>
    </ol>
  </dd>
<dt>If <var>ss</var> is a pseudo‐element</dt>
  <dd>
    <ol>
    <li>Append two <code class=char>U+003A</code>
    <code class=charname>COLON</code> characters (<code>::</code>)
    to <var>r</var>.</li>
    <li>Append the
    <a href="#algorithm-normalize-an-ident" title="normalize a string (IDENT) as an IDENT">normalized</a>
    name (in <a href="#lower-case">lower‐case</a>) of the pseudo‐element
    to <var>r</var>.</li>
    <li>If the pseudo‐element has any arguments:
        The pseudo‐element is not supported by this version of 
        <abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
        and therefore no 
        <abbr title="Selectors Serialization Format for Testing">SSFT</abbr> 
        representation is defined for <var>ss</var>.  Stop the algorithm.
    </li>
    </ol>
  </dd>
</dl>
</li>
<li>Then, <var>r</var> is the
<abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representation of <var>ss</var>.</li>
</ol>

</div>

<div class=section id=serializing-groups-of-selectors>
<h3>Serializing Groups of Selectors</h3>

<p>No <abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representation is defined for an invalid 
<a href="http://www.w3.org/TR/css3-selectors/#grouping">group of 
selectors</a>.</p>

<p>To 
<dfn id=algorithm-serialize-a-group-of-selectors title="serialize a group of selectors">serialize
a group of selectors (<dfn id=var-gs><var>gs</var></dfn>)</dfn>,
the following algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
<li>Let <dfn id=var-result><var>result</var></dfn> an empty string.</li>
<li>For each selector (<dfn id=var-selector><var>selector</var></dfn>) in 
<var>gs</var>:
  <ol>
  <li>If <var>selector</var> is <em>not</em> the first selector
  in the <var>gs</var>, then append a <code class=char>U+002C</code>
  <code class=charname>COMMA</code> (<code class=char>,</code>) followed by a
  <a href="#newline">newline</a> to <var>result</var>.</li>
  <li>Append four <code class=char>U+0020</code>
  <code class=charname>SPACE</code> characters to <var>result</var>.</li>
  <li>Process each sequence of simple selectors or
  combinator in <var>selector</var> as following:
    <dl class=switch>
    <dt>If it is a sequence of simle selector 
    (<dfn id=var-sss><var>sss</var></dfn>)</dt>
      <dd>
        <ol>
        <li>If <var>sss</var> contains a universal or type selector, then
        <a href="#algorithm-serialize-a-simple-selector" title="serialize a simple selector">serialize
        that simple selector</a> and append the result to
        <var>result</var>.</li>
        <li>Otherwise, i.e. if <var>sss</var> does not contain a universal or 
        type selector, then
        <a href="#algorithm-serialize-a-simple-selector" title="serialize a simple selector">serialize
        a simple selector <code>*</code></a> and append the result to
        <var>result</var>.</li>
        <li><a href="#algorithm-serialize-a-simple-selector" title="serialize a simple selector">Serialize
        any attribute selectors</a> in <var>sss</var>, sort the results,
        then append them to <var>result</var> in order.</li>
        <li><a href="#algorithm-serialize-a-simple-selector" title="serialize a simple selector">Serialize
        any class selectors</a> in <var>sss</var>, sort the results,
        then append them to <var>result</var> in order.</li>
        <li><a href="#algorithm-serialize-a-simple-selector" title="serialize a simple selector">Serialize
        any <abbr>ID</abbr> selectors</a> in <var>sss</var>, sort the results,
        then append them to <var>result</var> in order.</li>
        <li><a href="#algorithm-serialize-a-simple-selector" title="serialize a simple selector">Serialize
        any pseudo‐class selectors</a> in <var>sss</var>, sort the results,
        then append them to <var>result</var> in order.</li>
        <li><a href="#algorithm-serialize-a-simple-selector" title="serialize a simple selector">Serialize
        any pseudo elements</a> in <var>sss</var>, sort the results,
        then append them to <var>result</var> in order.</li>
        <li>Append a <a href="#newline">newline</a> to <var>result</var>.</li>
        </ol>
      </dd>
    <dt>If it is a combinator (<dfn id=var-c><var>c</var></dfn>)</dt>
      <dd>
        <ol>
        <li>Append two <code class=char>U+0020</code>
        <code class=charname>SPACE</code> characters to <var>result</var>.</li>
        <li>Process <var>c</var> as following:

          <dl class=switch>
          <dt>If <var>c</var> is descendant combinator (white space)</dt>
            <dd>Append a <code class=char>U+0020</code>
            <code class=charname>SPACE</code> character to
            <var>result</var>.</dd>
          <dt>If <var>c</var> is child combinator
          (<code class=char>></code>)</dt>
            <dd>Append a <code class=char>U+003E</code>
            <code class=charname>GREATER-THAN SIGN</code>
            (<code class=char>></code>) character to <var>result</var>.</dd>
          <dt>If <var>c</var> is adjacent sibling combinator
          (<code class=char>+</code>)</dt>
            <dd>Append a <code class=char>U+002B</code>
            <code class=charname>PLUS SIGN</code> (<code class=char>+</code>)
            character to <var>result</var>.</dd>
          <dt>If <var>c</var> is general sibling combinator
          (<code class=char>~</code>)</dt>
            <dd>Append a <code class=char>U+007E</code>
            <code class=charname>TILDE</code> (<code class=char>~</code>)
            character to <var>result</var>.</dd>
          </dl>
        </li>
        <li>Append a <code class=char>U+0020</code>
        <code class=charname>SPACE</code> character to
        <var>result</var>.</li>
        </ol>
      </dd>
    </dl>
  </ol>
</li>
<li>Then, <var>result</var> is the 
<abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representation of <var>gs</var>.</li>
</ol>

</div>

</div>

<div class="section" id="parsing">
<h2>Parsing 
<abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
Representations of Selectors</h2>

<p>Since <a href="#algorithm-serialize-a-group-of-selectors">the serializing 
algorithm for groups of selectors</a> is so designed that it always outputs a
valid <a href="http://www.w3.org/TR/css3-selectors/#grouping">group of
selectors</a>, no special parser for the
<abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representation is necessary.  Any conforming parser for
<a href="http://www.w3.org/TR/css3-selectors/#grouping">groups of
selectors</a> <em class=rfc2119>MAY</em> be used
to parse <abbr title="Selectors Serialization Format for Testing">SSFT</abbr> 
representations of 
<a href="http://www.w3.org/TR/css3-selectors/#grouping">groups of 
selectors</a>.</p>

<p>Likewise, <a href="#algorithm-serialize-a-simple-selector">the serializing
algorithm for simple selectors</a> always outputs a valid
<a href="#simple-selector">simple selector</a> and therefore any
conforming parser for <a href="#simple-selector">simple selector</a>
<em class=rfc2119>MAY</em> be used to parse 
<abbr title="Selectors Serialization Format for Testing">SSFT</abbr>
representations of <a href="#simple-selector">simple selectors</a>.</p>
</div>

<div class="section" id="examples">
<h2>Examples</h2>

<p class=section-info>This section is <em>non‐normative</em>.</p>

<div class="ed issue">
<p><a href="http://suika.fam.cx/gate/2007/css/parser-interface">Try demo</a>,
by choosing <q>Selectors</q> radio button.</p>

<div class="example figure block">
<div class="caption">...</div>

<pre><code>...</code></pre>
</div>

</div>

</div>

<div id="references" class="section reference">
<h2>References</h2>

<div id="normative-references" class="section normative reference">
<h3>Normative References</h3>

<dl>
<dt id="ref-KEYWORDS">KEYWORDS</dt>
  <dd><cite><a href="urn:ietf:rfc:2119">Key words for use in 
  <abbr>RFCs</abbr> to Indicate Requirement Levels</a></cite>,
  <abbr title="Internet Engineering Task Force">IETF</abbr> 
  <a href="urn:ietf:bcp:14"><abbr title="Best Current Practice">BCP</abbr> 
  14</a>, <abbr title="Request for Comments">RFC</abbr> 2119, 
  <time datetime=1997-03>March 1997</time>.
  This version of the specification is referenced.</dd>
<dt id=ref-SELECTORS>SELECTORS</dt>
  <dd><a href="http://www.w3.org/TR/2005/WD-css3-selectors-20051215"><cite>Selectors</cite></a>,
  <abbr title="World Wide Web Consortium">W3C</abbr> Working Draft,
  <time datetime=2005-12-15>15 December 2005</time>.  Work in progress.  
  <a href="http://www.w3.org/TR/css3-selectors">The latest version</a>
  of the specification is referenced.</dd>
</dl>
</div>

<div id="informative-references" class="section informative reference">
<h3>Non‐normative References</h3>

<dl>
<dt id=ref-CSS>CSS</dt>
  <dd><cite><a href="http://www.w3.org/TR/2007/CR-CSS21-20070719">Cascading
  Style Sheets Level 2 Revision 1 (<abbr>CSS</abbr> 2.1)
  Specification</a></cite>, 
  <abbr title="World Wide Web Consortium">W3C</abbr> Candidate
  Recommendation, <time datetime=2007-07-19>19 July 2007</time>.
  Work in progress.  The latest version of the specification is
  available at 
  <code class=URI>&lt;<a href="http://www.w3.org/TR/CSS21">http://www.w3.org/TR/CSS21</a>></code>.</dd>
<dt id=ref-CSSOM>CSSOM</dt>
  <dd><cite><a href="http://dev.w3.org/cvsweb/~checkout~/csswg/cssom/Overview.html?rev=1.55&amp;content-type=text/html;%20charset=utf-8">Cascading
  Style Sheets Object Model (<abbr>CSSOM</abbr>)</a></cite>,
  <abbr title="World Wide Web Consortium">W3C</abbr> Editor's Draft,
  <time datetime=2007-06-18>18 June 2007</time>.  Work in progress.
  The latest Editor's Draft of the specification is available at
  <code class=URI>&lt;<a href="http://dev.w3.org/csswg/cssom/Overview.html">http://dev.w3.org/csswg/cssom/Overview.html</a>></code>.</dd>
<dt id=ref-HTML5>HTML5</dt>
  <dd><cite><a href="http://whatwg.org/html5"><abbr>HTML</abbr> 5</a></cite>,
  <abbr title="Web Hypertext Application Technology Working Group">WHATWG</abbr>
  Working Draft, <time datetime="2007-11-03">3 November 2007</time>.
  Work in progress.</dd>
<dt id=ref-SAPI>SAPI</dt>
  <dd><cite><a href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/selectors-api/Overview.html?rev=1.28&amp;content-type=text/html;%20charset=utf-8">Selectors <abbr>API</abbr></a></cite>,
  <abbr title="World Wide Web Consortium">W3C</abbr> Editor's Draft,
  <time datetime=2007-08-29>29 August 2007</time>.  Work in progress.
  The latest Editor's Draft of the specification is available at
  <code class=URI>&lt;<a href="http://dev.w3.org/2006/webapi/selectors-api/Overview.html">http://dev.w3.org/2006/webapi/selectors-api/Overview.html</a>></code>.
  The latest published version of the specification is available at
  <code class=URI>&lt;<a href="http://www.w3.org/TR/selectors-api/">http://www.w3.org/TR/selectors-api/</a>></code>.</dd>
<dt id=ref-XBL2>XBL2</dt>
  <dd><cite><a href="http://www.mozilla.org/projects/xbl/xbl2.html"><abbr>XBL</abbr>
  2.0</a></cite>, Mozilla.org, <time datetime=2007-03-15>15 Mar 2007</time>.
  Work in progress.  The latest
  <abbr title="World Wide Web Consortium">W3C</abbr>‐published
  version of the specification is available at
  <code class=URI>&lt;<a href="http://www.w3.org/TR/xbl/">http://www.w3.org/TR/xbl/</a>></code>.</dd>
</dl>
</div>

</div>

</body>
</html>
